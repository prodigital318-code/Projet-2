<!doctype html><html lang="fr"><meta charset="utf-8">
<title>Connexion…</title>
<script type="module">
  import { supabase } from './config.js';

  supabase.auth.onAuthStateChange(async (event, session) => {
    if (event === 'SIGNED_IN' && session) await route();
  });

  (async () => {
    const { data:{ session } } = await supabase.auth.getSession();
    if (session) await route();
  })();

  async function route(){
    const { data:{ session } } = await supabase.auth.getSession();
    if (!session?.user) return location.replace('index.html');

    // Vérif table admins(id uuid pk → = auth.uid())
    const { data: row, error } = await supabase
      .from('admins').select('id').eq('id', session.user.id).maybeSingle();

    if (error) return location.replace('employe.html');
    location.replace(row ? 'admin.html' : 'employe.html');
  }
</script>
